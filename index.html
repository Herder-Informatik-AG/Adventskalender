<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <title>Adventskalender - DEMO</title>
</head>
<div class="root">
  <div class="width-large">
    <div class="row">
      <div class="col-12 ce_image first block no-margin" id="adventskalender">
        <div class="inner">
          <figure class="image-container">
            <div class="image-mask">
              <img src="assets/46_night.png" width="800" height="564" alt="" itemprop="image">
            </div>
          </figure>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- COPY EVERYTHING BELOW THIS INTO "ce_html5-Adventskalender" -->

<script>
  var adventskalender = document.querySelector('#adventskalender img');
  var radius = 0.05;

  // Coordinates of the doors. The coordinates are relative to the image size, i.e. in [0, 1]
  var doors = [[0.6, 0.51], [0.41, 0.67], [0.92, 0.62], [0.18, 0.05], [0.76, 0.7], [0.16, 0.72], [0.82, 0.06], [0.33, 0.83], [0.15, 0.87], [0.07, 0.52], [0.5, 0.36], [0.72, 0.41], [0.95, 0.74], [0.15, 0.39], [0.64, 0.25], [0.68, 0.92], [0.27, 0.17], [0.56, 0.86], [0.31, 0.34], [0.27, 0.61], [0.14, 0.18], [0.81, 0.28], [0.44, 0.14], [0.56, 0.07]];

  var MousePos = [];

  adventskalender.addEventListener("mousemove", handleMouseMove);
  adventskalender.addEventListener("click", handleClick);

  /**
   * Computes the relative coordinates of the mouse inside the image. Both coordinates are in [0, 1]
   */
  function getMousePos(e){
    const x = e.offsetX / e.target.width;
    const y = e.offsetY / e.target.height;
    return [x, y];
  }

  /**
   * Checks whether a point is close enough to a door to be considered a click on that door.
   */
  function pointInCircle(x, y, cx, cy, r) {
    var squaredDist = (x - cx) * (x - cx) + (y - cy) * (y - cy);
    return squaredDist <= r * r;
  }

  /**
   * Checks whether the mouse is over a door. If so, returns the ID of the door. Otherwise, returns 0.
   */
  function findDoor(MousePos) {
    for(i = 0; i < doors.length; i++) {
      var door = doors[i];
      if(pointInCircle(MousePos[0], MousePos[1], door[0], door[1], radius)) {
        return i + 1;
      }
    }
    return null;
  }

  /**
   * Opens the door with the given ID
   */
  function openDoor(doorID){
    if (!canBeOpened(doorID)) {
      window.alert("Tür " + doorID + " kann noch nicht geöffnet werden! Bitte warte bis zum " + doorID + ". Dezember.");
      return;
    }
    window.alert("Tür " + doorID + " wurde geöffnet!");
  }

  /**
   * Checks whether the door can be opened based on day of the month.
   */
  function canBeOpened(doorID) {
    var today = new Date();
    var day = today.getDate();
    return doorID <= day;
  }

  /**
   * Handles the click event on the image. If the click is on a door, the door is opened.
   */
  function handleClick(e) {
    MousePos = getMousePos(e);
    var clickGoal = findDoor(MousePos);
    if(clickGoal > 0) {
      openDoor(clickGoal);
    }
  }

  /**
   * Changes the style of the cursor depending on whether the mouse is over a door or not
   */
  function handleMouseMove(e) {
    mousePos = getMousePos(e);
    if(findDoor(mousePos) > 0) {
      if (canBeOpened(findDoor(mousePos))) {
        adventskalender.style.cursor = "pointer";
      } else {
        adventskalender.style.cursor = "not-allowed";
      }
    } else {
      adventskalender.style.cursor = "default";
    }
  }
</script>
<style>
  #adventskalender img {
    border-radius: 10px;
    width: auto;
  }
</style>